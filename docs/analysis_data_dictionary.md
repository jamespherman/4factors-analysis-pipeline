# Analysis Data Dictionary

This document has two parts. First, it defines the canonical data structure for the `session_data.analysis` field. All per-session analysis functions must save their results in this format. Second, it defines the `analysis_plan` that is used to guide the analyses that are run.

The guiding principle is to organize data by **Analysis Type -> Alignment Event -> Condition/Comparison Name**.

---
## Analysis Plan Input Structure (`analysis_plan`)

The `analysis_plan` structure is generated by `define_4factors_task_conditions.m` (when called with no arguments) and serves as the primary input for driving the main analysis scripts. It defines which analyses to run, what conditions to compare, and how to configure them.

-   **Path:** This is a standalone struct, typically loaded at the beginning of an analysis script, e.g., `analysis_plan = define_4factors_task_conditions();`.

### Fields

-   `.alignment_events`: `[1 x nEvents] cell` - A cell array of character vectors, where each entry specifies an event to which neural data should be aligned (e.g., `'targetOn'`, `'saccadeOnset'`).

-   `.baseline_plan`: `[1 x nConditions] struct array` - Defines the set of "Baseline vs. Post-Event Activity" analyses to run. Each element of the array is a struct with the following field:
    -   `.name`: `char` - The name of the condition to be analyzed (e.g., `'is_high_reward'`). This name must correspond to one of the fields generated by `define_4factors_task_conditions(session_data)`.

-   `.roc_plan`: `[1 x nComps] struct array` - Defines the set of ROC-based comparisons to run. Each element of the array is a struct with the following fields:
    -   `.name`: `char` - The name of the comparison (e.g., `'reward'`).
    -   `.event`: `char` - The alignment event to use for this comparison.
    -   `.cond1`: `char` - The name of the first condition.
    -   `.cond2`: `char` - The name of the second condition.
    -   `.trial_mask`: `char` - The name of a logical mask to select a subset of trials for this comparison (e.g., `'is_in_rf'`).

-   `.anova_plan`: `struct` - Defines the parameters for running the N-way ANOVA.
    -   `.run`: `boolean` - A flag indicating whether to run the ANOVA.
    -   `.event`: `char` - The alignment event to use for the ANOVA.
    -   `.factors`: `[1 x nFactors] cell` - A cell array of character vectors with the names of the factors for the ANOVA (e.g., `'reward'`, `'salience'`).
    -   `.trial_mask`: `char` - The name of a logical mask to select a subset of trials.

-   `.diagnostic_plots`: `[1 x nPlots] struct array` - Defines the set of diagnostic plots to be generated for each neuron.
    -   `.event`: `char` - The alignment event for the plot.
    -   `.title`: `char` - The title of the plot panel.
    -   `.conditions_to_compare`: `[1 x nConditions] cell` - The names of the conditions to be plotted together.

## Top-Level Output Structure (`session_data.analysis`)

-   `session_data.analysis`
    -   `.roc_comparison`: Results from `analyze_roc_comparison.m`
    -   `.baseline_comparison`: Results from `analyze_baseline_comparison.m`
    -   `.anova_results`: Results from `analyze_anova.m`
    -   `.selected_neurons`: List of neurons selected for analysis.
    -   `.core_data`: Processed data used for analyses.
    -   `.scSide` (for SC sessions): The determined side of the Superior Colliculus recording ('left' or 'right').
    -   `.sig_epoch_comparison` (for SC sessions): Significance of epoch comparisons from `screen_sc_neurons.m`.

---

## 1. ROC Comparison

Compares firing rates between two conditions.

-   **Path:** `session_data.analysis.roc_comparison.(eventName).(compName)`
-   **`eventName`**: `char` - The name of the alignment event (e.g., `'CUE_ON'`, `'outcomeOn'`).
-   **`compName`**: `char` - The name of the specific comparison (e.g., `'Dist_at_Cue'`, `'RPE_at_Outcome'`).

### Fields

-   `.sig`: `[nNeurons x nTimeBins] double` - Matrix of p-values from the ROC analysis at each time bin.
-   `.time_vector`: `[1 x nTimeBins] double` - The time vector corresponding to the columns of `.sig`.
-   `.cond_names`: `[1 x 2] cell` - Cell array containing the names of the two conditions that were compared (e.g., `{'is_normal_dist', 'is_uniform_dist'}`).

---

## 2. Baseline Comparison

Compares post-event firing rates to a pre-event baseline period.

-   **Path:** `session_data.analysis.baseline_comparison.(eventName).(condName)`
-   **`eventName`**: `char` - The name of the alignment event (e.g., `'CUE_ON'`, `'outcomeOn'`).
-   **`condName`**: `char` - The name of the condition being analyzed (e.g., `'is_normal_dist'`, `'is_common_reward_no_spe'`).

### Fields

-   `.sig`: `[nNeurons x nTimeBins] double` - Matrix of p-values from the ROC analysis comparing each post-event bin to the pooled baseline.
-   `.time_vector`: `[1 x nTimeBins] double` - The time vector for the post-event period, corresponding to the columns of `.sig`.

---

## 3. ANOVA Results

Results from the N-way ANOVA analysis.

-   **Path:** `session_data.analysis.anova_results.(eventName).(p_value_name)`
-   **`eventName`**: `char` - The name of the alignment event (e.g., `'CUE_ON'`).
-   **`p_value_name`**: `char` - The name of the factor or interaction term for which p-values are reported (e.g., `'p_interaction'`, `'p_value'`).

### Fields

The fields under `(p_value_name)` are typically `[nNeurons x nTimeBins]` double matrices containing the p-values for that factor over time.
