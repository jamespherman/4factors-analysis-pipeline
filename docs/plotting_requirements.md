# Plotting Requirements

This document defines the specifications for all final, publication-quality figures generated from the `aggregated_analysis_data.mat` file.

**Note:** The exact components of each figure (e.g., the number of columns, the specific conditions compared) are dynamically determined by the `analysis_plan` generated by `define_task_conditions.m`. This document will refer to the relevant fields in the `analysis_plan` as the source of truth.

---
## 1. Aggregated ANOVA Plot

* **Script:** `plot_aggregated_anova.m`
* **Purpose:** To visualize the proportion of neurons showing a statistically significant effect for each factor and interaction in the ANOVA models, resolved over time.
* **Layout:** A single figure with a multi-panel grid.
    * **Rows:** Each ANOVA effect term defined in the `effect_terms` variable within the script.
    * **Columns:** Each alignment event specified in `analysis_plan.events`.
* **Plot Type:** A line plot showing the mean proportion of significant neurons across all sessions, with faint traces for individual sessions in the background.
* **Data Requirements:** Requires an `anova_results` struct, nested as `.(analysis_name).(event_name)`. The data at this level must be a struct array (one element per session) containing fields for the p-value of each ANOVA term (e.g., `.p_reward`) and a corresponding `.time_vector`.
* **Axes:**
    * **X-Axis:** Time (s) relative to the alignment event.
    * **Y-Axis:** Proportion of Significant Neurons.
---
## 2. Aggregated Baseline Comparison Plot

* **Script:** `plot_aggregated_baseline_comparison.m`
* **Purpose:** To visualize the proportion of neurons whose firing rate significantly increases or decreases relative to a pre-event baseline period, across all relevant conditions and time epochs in a single view.
* **Layout:** A single, consolidated figure with a multi-panel grid.
    * **Rows:** Each condition defined in `analysis_plan.baseline_plan`. [cite_start]The specific conditions are determined dynamically from the plan but will correspond to factors like reward, salience, identity, and probability [cite: 2345-2348].
    * **Columns:** Each alignment event specified in `analysis_plan.events` (e.g., `fixOn`, `targetOn`, etc.).
* **Plot Type:** A bidirectional filled bar/stairs plot (`barStairsFill`) will be used for each subplot.
    * Positive Y-values will represent the proportion of neurons with a significant **increase** in firing rate from baseline.
    * Negative Y-values will represent the proportion of neurons with a significant **decrease** in firing rate from baseline.
* **Data Requirements:** The function will use the `baseline_comparison` field from the aggregated data file, which is structured as `.(event_name).(condition_name)`. This data must contain a `.sig` matrix (with `+1` for increase, `-1` for decrease) and a `.time_vector`.
* **Axes:**
    * **X-Axis:** Time (s) relative to the alignment event.
    * **Y-Axis:** Proportion of Neurons.
* **Formatting Conventions:**
    * **Row & Column Labeling:** Each row will be labeled on the **left** with a concise version of the condition name (e.g., "High Reward"). The alignment event for each column will be indicated by the **x-axis label** on the bottom plot of that column.
    * **Axis Labels & Ticks:** X-axis labels (e.g., 'Time from targetOn (s)') and their corresponding tick labels will only appear on the **bottom-most row of plots**. [cite_start]Y-axis labels ("Proportion of Neurons") and their tick labels will only appear on the **left-most column of plots** [cite: 133-136].
    * **Limits:** All subplots within the same row should share the same Y-axis limits to allow for direct visual comparison of effect sizes across different time epochs. All plots will have their Y-axis centered at 0.

---
## 3. Aggregated ROC Comparison Plot

* **Script:** `plot_aggregated_roc_comparison.m`
* **Purpose:** To visualize the proportion of neurons that show a significant firing rate preference between two experimental conditions, across all relevant comparisons and time epochs in a single view.
* **Layout:** A single, consolidated figure with a multi-panel grid.
    * [cite_start]**Rows:** Each comparison defined in `analysis_plan.roc_plan` (e.g., 'reward', 'salience', 'identity', 'probability') [cite: 2350-2357].
    * [cite_start]**Columns:** Each alignment event specified in `analysis_plan.events`[cite: 2337].
* **Plot Type:** A bidirectional filled bar/stairs plot (`barStairsFill`).
    * Positive Y-values represent the proportion of neurons with a significant preference for the second condition (`cond2` in the plan).
    * Negative Y-values represent the proportion of neurons with a significant preference for the first condition (`cond1` in the plan).
* **Data Requirements:** The function will use the `roc_comparison` field from the aggregated data file, structured as `.(event_name).(comp_name)`. [cite_start]This data must contain a `.sig` matrix (with `+1` for cond2 preference, `-1` for cond1 preference) and a `.time_vector` [cite: 2877-2883].
* **Axes:**
    * **X-Axis:** Time (s) relative to the alignment event.
    * **Y-Axis:** Proportion of Neurons.
* **Formatting Conventions:**
    * **Titles:** No overarching `sgtitle` will be used.
    * **Row & Column Labeling:** Each row will be labeled on the **left** with a concise version of the comparison name (e.g., "Reward"). The alignment event for each column will be indicated by the **x-axis label** on the bottom plot of that column.
    * **Axis Labels & Ticks:** X-axis labels (e.g., 'Time from targetOn (s)') and their corresponding tick labels will only appear on the **bottom-most row of plots**. [cite_start]Y-axis labels ("Proportion of Neurons") and their tick labels will only appear on the **left-most column of plots** [cite: 133-136].
    * **Limits:** All subplots within the same row should share the same Y-axis limits to facilitate comparison. All plots will have their Y-axis centered at 0.
    * **Colors:** Two distinct, consistent colors from `richColors.m` should be used for the two conditions across the entire figure.

---
## 4. Aggregated Behavioral Plot

* **Script:** `plot_aggregated_behavior.m`
* **Purpose:** To visualize the proportion of *sessions* that show a significant behavioral effect for each factor in the two-model analysis (Image vs. Bullseye trials).
* **Layout:** A single figure with a grid.
    * **Rows:** Each behavioral measure defined in `analysis_plan.behavior_plan` (e.g., `reaction_time`, `peak_velocity`).
    * **Columns:** Main Effects vs. Interaction Effects.
* **Plot Type:** Grouped bar plot, where bars within a group represent the two models (Image vs. Bullseye).
* **Data Requirements:** Requires a `behavioral_results` struct, nested by `.(analysis_name)`. The data at this level must be a single, large table containing the concatenated LME model results from all sessions, including `Effect`, `pValue`, and `session_id` columns.
* **Axes:**
    * **X-Axis:** Categorical (Factor names).
    * **Y-Axis:** Proportion of Significant Sessions.

---
## 5. Aggregated Decoding Plot

* **Script:** `plot_aggregated_decoding.m`
* **Purpose:** To visualize decoder performance and its ability to generalize across different task factors and time epochs.
* **Layout:** A single figure with a large grid of subplots for each test defined in `analysis_plan.decoding_plan.testing_plan`.
* **Plot Type:** Scatter plot, where each point represents a single session and includes error bars for the 95% confidence interval.
* **Data Requirements:** Requires a `population_decoding` struct, nested by `.(test_name)`. The data at this level must contain `.accuracy` and `.accuracy_ci` values for each session.
* **Axes:**
    * **X-Axis:** Standard Accuracy (within-condition/epoch).
    * **Y-Axis:** Generalization Accuracy (across-condition/epoch).

---
## 6. Aggregated Window ROC Plot

* **Script:** `plot_aggregated_window_roc.m`
* **Purpose:** To visualize epoch-based factor selectivity at the single-neuron level, supporting Hypothesis 2 testing (SNc subregion specialization).
* **Figures Generated:** Two complementary figures.

### 6.1 Figure 1: Proportion Significant Grid

* **Layout:** A single figure with a multi-panel grid.
    * **Rows:** Each factor defined in `analysis_plan.window_roc_plan.factors` (reward, salience, identity, probability).
    * **Columns:** Each epoch defined in `analysis_plan.window_roc_plan.epoch_windows` (visual, delay, perisaccade, postreward).
* **Plot Type:** Bidirectional bar plot.
    * Positive Y-values represent the proportion of neurons with significant preference for condition 1 (high/face, AUC > 0.5).
    * Negative Y-values represent the proportion of neurons with significant preference for condition 2 (low/non-face, AUC < 0.5).
* **Data Requirements:** Requires a `window_roc` struct, nested as `.(epoch_name).(factor_name)`. Each element must contain `.auc` and `.p` arrays.
* **Axes:**
    * **X-Axis:** Single bar per subplot (no time dimension).
    * **Y-Axis:** Proportion of Neurons.
* **Formatting Conventions:**
    * Column headers indicate epoch names.
    * Row labels (leftmost column) indicate factor names.
    * Y-axis labels and ticks only on leftmost column.
    * All subplots in a row share the same Y-axis limits (centered at 0).

### 6.2 Figure 2: ROC Scatter Plots

* **Purpose:** Enable testing of Hypothesis 2 by comparing factor selectivity across individual neurons.
* **Layout:** A multi-panel grid showing pairwise factor comparisons.
    * Primary comparisons (cross-category): Reward vs Salience, Reward vs Identity, Probability vs Salience, Probability vs Identity
    * Secondary comparisons (within-category): Reward vs Probability, Salience vs Identity
* **Plot Type:** Scatter plot where each point represents one neuron.
    * X-axis: AUC for factor A
    * Y-axis: AUC for factor B
    * Reference lines at 0.5 (chance level) on both axes
    * Unity line for reference
* **Data Requirements:** Same as Figure 1, using `.auc` values for the visual epoch (primary) or other epochs.
* **Formatting Conventions:**
    * Square aspect ratio for each subplot.
    * Axis limits: [0, 1] for both axes.
    * Neuron count displayed in subplot title.