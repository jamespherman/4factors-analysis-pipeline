# Plotting Requirements

This document defines the specifications for all final, publication-quality figures generated from the `aggregated_analysis_data.mat` file.

**Note:** The exact components of each figure (e.g., the number of columns, the specific conditions compared) are dynamically determined by the `analysis_plan` generated by `define_task_conditions.m`. This document will refer to the relevant fields in the `analysis_plan` as the source of truth.

---
## 1. Aggregated ANOVA Plot

* **Script:** `plot_aggregated_anova.m`
* **Purpose:** To visualize the proportion of neurons showing a statistically significant effect for each factor and interaction in the ANOVA models, resolved over time.
* **Layout:** A single figure with a multi-panel grid.
    * **Rows:** Each ANOVA effect term defined in the `effect_terms` variable within the script.
    * **Columns:** Each alignment event specified in `analysis_plan.events`.
* **Plot Type:** A line plot showing the mean proportion of significant neurons across all sessions, with faint traces for individual sessions in the background.
* **Data Requirements:** Requires an `anova_results` struct, nested as `.(analysis_name).(event_name)`. The data at this level must be a struct array (one element per session) containing fields for the p-value of each ANOVA term (e.g., `.p_reward`) and a corresponding `.time_vector`.
* **Axes:**
    * **X-Axis:** Time (s) relative to the alignment event.
    * **Y-Axis:** Proportion of Significant Neurons.

---
## 2. Aggregated Baseline Comparison Plot

* **Script:** `plot_aggregated_baseline_comparison.m`
* **Purpose:** To visualize the proportion of neurons whose firing rate significantly increases or decreases relative to a pre-event baseline period.
* **Layout:** One figure is generated for each event in `analysis_plan.events`. Each figure contains a row of subplots.
    * **Columns:** Each condition defined in `analysis_plan.baseline_plan`.
* **Plot Type:** A bidirectional filled bar/stairs plot (`barStairsFill`). [cite_start]Positive Y-values represent an increase in firing rate; negative Y-values represent a decrease. [cite: 627-629]
* **Data Requirements:** Requires a `baseline_comparison` struct, nested as `.(event_name).(condition_name)`. The data must contain a `.sig` matrix (with `+1` for increase, `-1` for decrease) and a `.time_vector`.
* **Axes:**
    * **X-Axis:** Time (s) relative to the alignment event.
    * **Y-Axis:** Proportion of Neurons.

---
## 3. Aggregated ROC Comparison Plot

* **Script:** `plot_aggregated_roc_comparison.m`
* **Purpose:** To visualize the proportion of neurons that show a significant firing rate preference between two experimental conditions over time.
* **Layout:** One figure is generated for each event in `analysis_plan.events`. Each figure contains a row of subplots.
    * **Columns:** Each comparison defined in `analysis_plan.roc_plan`.
* **Plot Type:** A bidirectional filled bar/stairs plot (`barStairsFill`). [cite_start]Positive Y-values represent a preference for condition 2; negative Y-values represent a preference for condition 1. [cite: 748-749]
* **Data Requirements:** Requires a `roc_comparison` struct, nested as `.(event_name).(comp_name)`. The data must contain a `.sig` matrix (with `+1` for cond2 pref, `-1` for cond1 pref) and a `.time_vector`.
* **Axes:**
    * **X-Axis:** Time (s) relative to the alignment event.
    * **Y-Axis:** Proportion of Neurons.

---
## 4. Aggregated Behavioral Plot

* **Script:** `plot_aggregated_behavior.m`
* **Purpose:** To visualize the proportion of *sessions* that show a significant behavioral effect for each factor in the two-model analysis (Image vs. Bullseye trials).
* **Layout:** A single figure with a grid.
    * **Rows:** Each behavioral measure defined in `analysis_plan.behavior_plan` (e.g., `reaction_time`, `peak_velocity`).
    * **Columns:** Main Effects vs. Interaction Effects.
* **Plot Type:** Grouped bar plot, where bars within a group represent the two models (Image vs. Bullseye).
* **Data Requirements:** Requires a `behavioral_results` struct, nested by `.(analysis_name)`. The data at this level must be a single, large table containing the concatenated LME model results from all sessions, including `Effect`, `pValue`, and `session_id` columns.
* **Axes:**
    * **X-Axis:** Categorical (Factor names).
    * **Y-Axis:** Proportion of Significant Sessions.

---
## 5. Aggregated Decoding Plot

* **Script:** `plot_aggregated_decoding.m`
* **Purpose:** To visualize decoder performance and its ability to generalize across different task factors and time epochs.
* **Layout:** A single figure with a large grid of subplots for each test defined in `analysis_plan.decoding_plan.testing_plan`.
* **Plot Type:** Scatter plot, where each point represents a single session and includes error bars for the 95% confidence interval.
* **Data Requirements:** Requires a `population_decoding` struct, nested by `.(test_name)`. The data at this level must contain `.accuracy` and `.accuracy_ci` values for each session.
* **Axes:**
    * **X-Axis:** Standard Accuracy (within-condition/epoch).
    * **Y-Axis:** Generalization Accuracy (across-condition/epoch).